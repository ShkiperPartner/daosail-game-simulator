# DAOsail — Игра‑симулятор «Правила расхождения яхт» (Knowledge Base v1)

_Последнее обновление: 2025-08-13_

## 1) Коротко (что делаем и зачем)
Создаём браузерную обучающую игру по COLREGs/RRS для новичков DAOsail. MVP: простые схемы двух парусников, индикатор ветра, 3–5 базовых ситуаций, выбор действия и мгновенная обратная связь. Далее — режимы «Испытание сценариями», «Викторина», лёгкая симуляция в реальном времени, а затем — бэкенд + GPT для генерации сценариев и объяснений.

## 2) Цели и метрики успеха
- **Учебная ценность**: ≥80% правильных ответов после 15–20 минут игры у новичка (pre/post‑тест).
- **Усвоение правил**: покрытие COLREGs §12–17 (MVP), RRS §10–17 (этап 2).
- **Техническая готовность**: стабильный FPS на ноутбуке/планшете; <2 c на загрузку сценария.
- **Проектная готовность**: автосборка в CI, развертывание (Vercel), базовый аналитический лог событий.

## 3) Объём MVP (строго необходимое)
- 3–5 статичных ситуаций «расхождение парусников» (схемы + текст).
- Схематичная визуализация: треугольники‑лодки, курс, стрелка ветра (день/ночь).
- Выбор действия игроком → «правильно/неправильно» + короткое объяснение с номером правила.
- Простая страница UI: старт, выбор сценария, повтор.
- Минимальные ассеты, без физики; Phaser отрисовывает только схемы.

## 4) Игровые режимы (последовательно)
1. **Scenario Challenge** — текст + диаграмма, выбор действия, разбор ошибки.
2. **Quiz & Teach** — тест с вариантами и короткие объяснения, учёт прогресса.
3. **Лёгкая симуляция** — управление курсом/парусом, пауза при ошибке.
4. **ИИ‑режимы** (позже) — чат‑шкипер, VHF‑радио, динамические сценарии.

## 5) Технологии и архитектура
- **Клиент (MVP)**: HTML5 + JS + **Phaser.js** (2D), модульная структура сцен.
- **Опционально**: Matter.js/Planck.js для физики (этап 2–3), Three.js (3D, этап 4).
- **Бэкенд (этап 3)**: Node.js + Express, маршруты `/scenarios`, `/eval`.
- **LLM‑интеграция (этап 3)**: GPT‑API для генерации сценариев и объяснений, кеширование, шаблоны промптов, «стоп‑факты» (цитирование правил).

## 6) Контент и правила
- COLREGs §12–17 — обязательный минимум MVP.
- RRS §10–17 — добавляем на этапе 2.
- Каждому сценарию: цель, схема, шаги игрока, вердикт, краткое объяснение, ссылка на правило.

## 7) План по этапам (8 недель)
- **Нед. 1–2**: каркас Phaser, UI, 3–5 ситуаций, обратная связь, деплой на Vercel.
- **Нед. 3–4**: режимы «Scenario» и «Quiz», 20–30 сценариев, огни/знаки.
- **Нед. 5–6**: бэкенд + GPT, генерация сценариев, проверка свободных ответов.
- **Нед. 7–8**: опциональная 3D‑кнопка, оптимизация, офлайн‑режим, мульти‑язык.

## 8) Репозиторий и структура
```
daosail-game-simulator/
├─ public/                # статические ассеты
├─ src/
│  ├─ main.js             # вход, конфиг Phaser
│  ├─ scenes/
│  │  ├─ BootScene.js
│  │  ├─ MenuScene.js
│  │  ├─ ScenarioScene.js
│  │  └─ QuizScene.js
│  ├─ ui/                 # элементы интерфейса
│  ├─ logic/              # проверка правил, оценка
│  └─ data/               # сценарии (JSON)
├─ server/ (этап 3)       # Express: /scenarios, /eval
├─ tests/                 # юнит‑тесты логики
├─ .github/workflows/     # CI (линт, билд, деплой)
└─ README.md
```

## 9) Спецификация кастомного GPT‑помощника (для загрузки в «Instructions»)
**Роль:** «Игровой архитектор DAOsail». Помогает по архитектуре, Phaser/JS‑коду, логике правил COLREGs/RRS и аналитике.  
**Цели:** давать минимально достаточные решения (MVP‑подход), объяснять пошагово, задавать 1 уточняющий вопрос за раз, предлагать проверяемые примеры.  
**Инструменты/источники:** материалы репозитория, сценарии, выдержки из COLREGs/RRS (как «стоп‑факты»).  
**Стиль:** кратко, без воды; сначала решение, затем детали.  

**Шаблон ответа:**
1) _Решение (коротко, по шагам)_; 2) _Пример кода/схема_; 3) _Проверка/тест_; 4) _Что дальше_.

**Примеры запросов к помощнику:**
- «Спроектируй `ScenarioScene` с выбором действия и проверкой правила 12.»
- «Дай каркас `main.js` и конфиг Phaser.»
- «Предложи JSON‑схему для сценария (цель, входные данные, правильный ответ, объяснение, ссылка на правило).»
- «Как валидировать свободный ответ игрока до подключения GPT?»

## 10) Критерии приёмки (MVP)
- Работают 3–5 статичных сценариев; выбор → вердикт; отображение номера правила.
- Страница грузится < 2 с; без критических ошибок в консоли.
- Кодовая база собирается CI и деплоится на Vercel из `main`.
- Минимальные тесты логики (например, проверка правильности ответа).

## 11) Риски и как снизить
- **Неточный ИИ** → шаблоны промптов + «стоп‑факты» (цитаты правил), кеш.
- **Сложность физики** → вынести физику в этап 2–3, начать с чистых схем.
- **Перегруз контента** → итеративно: сначала COLREGs §12–17, затем остальное.
- **Производительность** → спрайты/вектор простые; отложенная загрузка ассетов.

## 12) Ближайшие шаги
1. Создать репозиторий `daosail-game-simulator` (public/private — на ваш выбор).
2. Инициализировать шаблон Phaser и закоммитить каркас сцен.
3. Добавить 3–5 JSON‑сценариев (COLREGs §12–17) и простую проверку ответов.
4. Настроить Vercel‑деплой из ветки `main`.
5. Создать кастомный GPT с инструкциями из раздела §9 и загрузить этот файл в знания.

---

## Приложение A — Исходный поэтапный план (сводка)
(См. загруженный план этапов разработки с описанием Часть 1–4, режимами, LLM‑интеграцией, 3D и графиком работ.)